#!/usr/bin/env bash

# ===================================================
#  ALEXXP62 CONSOLE - NEXT GEN ULTRA EDITION
#                     2025 Edition
# ===================================================
#  Discord : https://discord.gg/steamunlocker
# ===================================================

set -e

# Next-Gen Neon Color Theme
RESET="\e[0m"
BOLD="\e[1m"
DIM="\e[2m"
UNDERLINE="\e[4m"

CYAN="\e[96m"
BLUE="\e[94m"
PURPLE="\e[95m"
GREEN="\e[92m"
YELLOW="\e[93m"
RED="\e[91m"
WHITE="\e[97m"

NEON_GREEN="\e[38;5;82m"
NEON_PURPLE="\e[38;5;165m"
NEON_BLUE="\e[38;5;75m"
GLOW="\e[38;5;51m"
DANGER="\e[38;5;196m"

clear

echo -e "${NEON_PURPLE}${BOLD}             NEXT GEN ULTRA EDITION - 2026${RESET}"
echo -e "${GLOW}             AvancÃ© â€¢ Futuristique â€¢ Automatisation d'Ã©tlite${RESET}"
echo -e "${DIM}      Discord: https://discord.gg/steamunlocker${RESET}"
echo -e "${NEON_BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}\n"

# Utility Functions
progress() { echo -e "${NEON_GREEN}${BOLD}âž¤ $1${RESET}"; }
success() { echo -e "${GREEN}${BOLD}âœ“ $1${RESET}"; }
warning() { echo -e "${YELLOW}${BOLD}! $1${RESET}"; }
error() { echo -e "${RED}${BOLD}âœ˜ $1${RESET}"; }

print_box_header() {
    local text="$1"
    local color="${2:-$NEON_PURPLE}"
    echo -e "${color}${BOLD}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${RESET}"
    echo -e "${color}${BOLD}â•‘${RESET} ${WHITE}${BOLD}$text$(printf '%*s' $((58 - ${#text})) '') ${color}${BOLD}â•‘${RESET}"
    echo -e "${color}${BOLD}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}\n"
}

print_menu_option() {
    local num="$1"
    local text="$2"
    echo -e "${NEON_BLUE}   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”${RESET}"
    echo -e "${NEON_BLUE}   â”‚${RESET} ${WHITE}${BOLD}[${NEON_GREEN}${num}${WHITE}]${RESET} ${YELLOW}${text}$(printf '%*s' $((48 - ${#text} - 3)) '') ${NEON_BLUE}â”‚${RESET}"
    echo -e "${NEON_BLUE}   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${RESET}"
}

# Main Menu
main_menu() {
    clear

    echo -e "${NEON_PURPLE}${BOLD}              CONSOLE DE GESTION DU DÃ‰VELOPPEMENT${RESET}\n"

    print_box_header "OPTIONS PRINCIPALES" $NEON_PURPLE

    print_menu_option "1" "IDX Tool Setup (Nix + QEMU Environment)"
    print_menu_option "2" "IDX VPS Maker (Remote Deployment)"
    print_menu_option "3" "Sortir"

    echo -e "\n${NEON_BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    read -p $'\e[93m\e[1m   SÃ©lectionne une option [1-3]: \e[0m' op
    echo
}

# Main Loop
while true; do
    main_menu

    case $op in
        1)
            clear
          
            print_box_header "IDX TOOL SETUP" $NEON_PURPLE

            progress "Initialisation du nettoyage de l'espace de travail..."
            cd ~ || exit 1
            rm -rf myapp flutter 2>/dev/null

            mkdir -p vps123
            cd vps123

            if [ ! -d ".idx" ]; then
                progress "CrÃ©ation d'un environnement de dÃ©veloppement IDX..."

                mkdir -p .idx
                cd .idx

                progress "GÃ©nÃ©ration de la configuration dev.nix..."
                cat > dev.nix << 'EOF'
{ pkgs, ... }: {
  channel = "stable-24.05";

  packages = with pkgs; [
    unzip
    openssh
    git
    qemu_kvm
    sudo
    cdrkit
    cloud-utils
    qemu
    flutter
    dart
  ];

  env = {
    EDITOR = "nano";
  };

  idx = {
    extensions = [
      "Dart-Code.flutter"
      "Dart-Code.dart-code"
    ];
    workspace = {
      onCreate = {};
      onStart = {};
    };
    previews = {
      enable = true;
    };
  };
}
EOF

                success "Configuration de l'outil IDX terminÃ©e !"
                echo -e "\n${GLOW}${BOLD}Location:${RESET} ${WHITE}~/vps123/.idx${RESET}"
                echo -e "${GLOW}${BOLD}Channel:${RESET}  ${WHITE}Nix Stable 24.05${RESET}"
                echo -e "${GLOW}${BOLD}Tools:${RESET}    ${WHITE}Flutter, Dart, QEMU, Git, SSH${RESET}\n"
            else
                warning "L'environnement IDX existe dÃ©jÃ  !"
                echo -e "   Path: ${WHITE}~/vps123/.idx${RESET}\n"
            fi

            echo -e "${NEON_BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
            read -p $'\e[93mAppuyez sur EntrÃ©e pour revenir...\e[0m' -r
            ;;

        2)
            clear
            echo -e "${NEON_PURPLE}"
          
            print_box_header "IDX VPS MAKER" "$NEON_PURPLE"

            progress "Lancement du gestionnaire de machines virtuelles..."
            echo -e "\n${CYAN}Diffusion en continu de la derniÃ¨re version depuis GitHub...${RESET}\n"

            if command -v curl >/dev/null 2>&1; then
                if bash <(curl -s https://raw.githubusercontent.com/AlexxP624/vps123/refs/heads/main/script); then
                    success "La session Cloud VM Manager s'est terminÃ©e avec succÃ¨s."
                else
                    error "Ã‰chec de rÃ©cupÃ©ration ou d'exÃ©cution du script."
                    warning "VÃ©rifiez votre connexion Internet ou l'Ã©tat de GitHub."
                fi
            else
                error "curl n'est pas installÃ©."
                warning "Installez-le avec : sudo apt install curl (ou Ã©quivalent)"
            fi
            echo -e "\n${NEON_BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
            read -p $'\e[93mAppuyez sur EntrÃ©e pour revenir au menu principal...\e[0m' -r
            ;;

        3)
            clear
            echo -e "${DANGER}"
     
            print_box_header "SESSION TERMINÃ‰E" $DANGER

            echo -e "${DIM}Discord: https://discord.gg/steamunlocker${RESET}\n"

            echo -e "${GLOW}${BOLD}Ã€ la prochaine session, opÃ©rateur ! ðŸš€${RESET}\n"
            exit 0
            ;;

        *)
            clear
            print_box_header "SÃ‰LECTION NON VALIDE" $DANGER
            error "Veuillez saisir une option valide (1â€“3)"
            sleep 2
            ;;
    esac
done
